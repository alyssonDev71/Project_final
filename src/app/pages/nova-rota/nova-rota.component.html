<div class="nova-rota-container">
  <div class="nova-rota-header">
    <div class="header-content">
      <div class="nova-rota-logo">üó∫Ô∏è</div>
      <div class="header-info">
        <h1>Criar Nova Rota</h1>
        <p>Configure uma nova rota de entrega com pontos de parada otimizados</p>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="cancelarCriacao()">Cancelar</button>
    </div>
  </div>

  <div class="nova-rota-content">
    <div class="form-section">
      <h2 class="section-title">Informa√ß√µes da Rota</h2>
      
      <form [formGroup]="novaRotaForm" (ngSubmit)="salvarRota()">
        <div class="form-row">
          <div class="form-group">
            <label for="nomeRota">Nome da Rota</label>
            <input 
              type="text" 
              id="nomeRota" 
              formControlName="nome"
              placeholder="Ex: S√£o Paulo - Santos Express"
              [class.error]="novaRotaForm.get('nome')?.invalid && novaRotaForm.get('nome')?.touched"
            >
            @if (novaRotaForm.get('nome')?.invalid && novaRotaForm.get('nome')?.touched) {
              <span class="error-message">Nome da rota √© obrigat√≥rio</span>
            }
          </div>

          <div class="form-group">
            <label for="dataRota">Data da Rota</label>
            <input 
              type="date" 
              id="dataRota" 
              formControlName="data"
              [class.error]="novaRotaForm.get('data')?.invalid && novaRotaForm.get('data')?.touched"
            >
            @if (novaRotaForm.get('data')?.invalid && novaRotaForm.get('data')?.touched) {
              <span class="error-message">Data √© obrigat√≥ria</span>
            }
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="horaInicio">Hora de In√≠cio</label>
            <input 
              type="time" 
              id="horaInicio" 
              formControlName="horaInicio"
              [class.error]="novaRotaForm.get('horaInicio')?.invalid && novaRotaForm.get('horaInicio')?.touched"
            >
            @if (novaRotaForm.get('horaInicio')?.invalid && novaRotaForm.get('horaInicio')?.touched) {
              <span class="error-message">Hora de in√≠cio √© obrigat√≥ria</span>
            }
          </div>

          <div class="form-group">
            <label for="veiculo">Ve√≠culo</label>
            <select 
              id="veiculo" 
              formControlName="veiculo"
              [class.error]="novaRotaForm.get('veiculo')?.invalid && novaRotaForm.get('veiculo')?.touched"
            >
              <option value="">Selecione um ve√≠culo</option>
              <option value="caminhao-pequeno">Caminh√£o Pequeno (3,5t)</option>
              <option value="caminhao-medio">Caminh√£o M√©dio (7t)</option>
              <option value="caminhao-grande">Caminh√£o Grande (14t)</option>
              <option value="van">Van de Carga</option>
            </select>
            @if (novaRotaForm.get('veiculo')?.invalid && novaRotaForm.get('veiculo')?.touched) {
              <span class="error-message">Selecione um ve√≠culo</span>
            }
          </div>
        </div>

        <div class="form-group full-width">
          <label for="descricao">Descri√ß√£o</label>
          <textarea 
            id="descricao" 
            formControlName="descricao"
            placeholder="Descreva detalhes importantes da rota..."
            rows="3"
          ></textarea>
        </div>

        <div class="pontos-section">
          <h3 class="subsection-title">Pontos da Rota</h3>
          
          <div class="ponto-item origem">
            <div class="ponto-icon">üèÅ</div>
            <div class="ponto-info">
              <label for="pontoOrigem">Ponto de Origem</label>
              <input 
                type="text" 
                id="pontoOrigem" 
                formControlName="pontoOrigem"
                placeholder="Ex: Centro de Distribui√ß√£o - S√£o Paulo, SP"
                [class.error]="novaRotaForm.get('pontoOrigem')?.invalid && novaRotaForm.get('pontoOrigem')?.touched"
              >
              @if (novaRotaForm.get('pontoOrigem')?.invalid && novaRotaForm.get('pontoOrigem')?.touched) {
                <span class="error-message">Ponto de origem √© obrigat√≥rio</span>
              }
            </div>
          </div>

          <div class="paradas-container">
            <div class="paradas-header">
              <h4>Paradas Intermedi√°rias</h4>
              <button type="button" class="btn-add-parada" (click)="adicionarParada()">
                <span>+</span> Adicionar Parada
              </button>
            </div>
            
            <div class="paradas-list">
              @for (parada of paradas(); track parada.id) {
                <div class="ponto-item parada">
                  <div class="ponto-icon">üìç</div>
                  <div class="ponto-info">
                    <label>Parada {{ parada.ordem }}</label>
                    <input 
                      type="text" 
                      [(ngModel)]="parada.endereco"
                      [ngModelOptions]="{standalone: true}"
                      placeholder="Ex: Rua das Flores, 123 - Santos, SP"
                    >
                    <div class="parada-detalhes">
                      <input 
                        type="number" 
                        [(ngModel)]="parada.tempoEstimado"
                        [ngModelOptions]="{standalone: true}"
                        placeholder="Tempo (min)"
                        min="5"
                        max="120"
                      >
                      <input 
                        type="text" 
                        [(ngModel)]="parada.observacoes"
                        [ngModelOptions]="{standalone: true}"
                        placeholder="Observa√ß√µes"
                      >
                    </div>
                  </div>
                  <button type="button" class="btn-remove-parada" (click)="removerParada(parada.id)">
                    ‚úï
                  </button>
                </div>
              }
              
              @if (paradas().length === 0) {
                <div class="no-paradas">
                  <p>Nenhuma parada adicionada. Clique em "Adicionar Parada" para incluir pontos intermedi√°rios.</p>
                </div>
              }
            </div>
          </div>

          <div class="ponto-item destino">
            <div class="ponto-icon">üèÅ</div>
            <div class="ponto-info">
              <label for="pontoDestino">Ponto de Destino</label>
              <input 
                type="text" 
                id="pontoDestino" 
                formControlName="pontoDestino"
                placeholder="Ex: Centro de Distribui√ß√£o - Santos, SP"
                [class.error]="novaRotaForm.get('pontoDestino')?.invalid && novaRotaForm.get('pontoDestino')?.touched"
              >
              @if (novaRotaForm.get('pontoDestino')?.invalid && novaRotaForm.get('pontoDestino')?.touched) {
                <span class="error-message">Ponto de destino √© obrigat√≥rio</span>
              }
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="cancelarCriacao()">
            Cancelar
          </button>
          <button 
            type="submit" 
            class="btn-primary"
            [class.loading]="isLoading()"
            [disabled]="novaRotaForm.invalid || isLoading()"
          >
            {{ isLoading() ? '' : 'Salvar Rota' }}
          </button>
        </div>
      </form>
    </div>

    <div class="mapa-section">
      <h2 class="section-title">Visualiza√ß√£o da Rota</h2>
      
      <div class="mapa-container">
        <div class="mapa-simulado">
          <div class="mapa-header">
            <span class="mapa-title">üó∫Ô∏è Mapa Interativo</span>
            <div class="mapa-controls">
              <button type="button" class="mapa-btn" (click)="centralizarMapa()">üìç</button>
              <button type="button" class="mapa-btn" (click)="otimizarRota()">‚ö°</button>
            </div>
          </div>
          
          <div class="mapa-area">
            <!-- Simula√ß√£o de mapa com pontos -->
            <div class="mapa-ponto origem-mapa" 
                 [style.left.%]="pontoOrigemPosicao.x" 
                 [style.top.%]="pontoOrigemPosicao.y">
              <div class="ponto-marker origem">üèÅ</div>
              <div class="ponto-label">Origem</div>
            </div>
            
            @for (parada of paradasMapa(); track parada.id) {
              <div class="mapa-ponto parada-mapa" 
                   [style.left.%]="parada.posicao.x" 
                   [style.top.%]="parada.posicao.y">
                <div class="ponto-marker parada">{{ parada.ordem }}</div>
                <div class="ponto-label">Parada {{ parada.ordem }}</div>
              </div>
            }
            
            <div class="mapa-ponto destino-mapa" 
                 [style.left.%]="pontoDestinoPosicao.x" 
                 [style.top.%]="pontoDestinoPosicao.y">
              <div class="ponto-marker destino">üèÅ</div>
              <div class="ponto-label">Destino</div>
            </div>
            
            <!-- Linha da rota -->
            @if (paradas().length > 0 || (novaRotaForm.get('pontoOrigem')?.value && novaRotaForm.get('pontoDestino')?.value)) {
              <svg class="rota-linha" viewBox="0 0 100 100" preserveAspectRatio="none">
                <path [attr.d]="rotaPath()" stroke="#4facfe" stroke-width="0.3" fill="none" stroke-dasharray="1,0.5"/>
              </svg>
            }
          </div>
          
          <div class="mapa-info">
            <div class="info-item">
              <span class="info-label">Dist√¢ncia Total:</span>
              <span class="info-value">{{ distanciaTotal() }} km</span>
            </div>
            <div class="info-item">
              <span class="info-label">Tempo Estimado:</span>
              <span class="info-value">{{ tempoTotal() }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Paradas:</span>
              <span class="info-value">{{ paradas().length }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  @if (message()) {
    <div class="message" [class]="messageType()">
      {{ message() }}
    </div>
  }
</div>
